@using MyPageOnGitHub.BlogContents
@using MyPageOnGitHub.Code

@inject ILoggerFactory LoggerFactory
@inject NavigationManager NavigationManager
@inject IMarkdownService MarkdownService

<MudStack Row="true">
    <MudFab Size="Size.Small" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ChevronLeft" OnClick="GoBack" />
    <MudFab Size="Size.Small" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ChevronRight" OnClick="GoForward" />
</MudStack>

<MarkdownPage MarkdownResource="@ResourceType" ItemIndex="@Index" />

<MudStack Row="true">
    <MudFab Size="Size.Small" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowCircleLeft" OnClick="GoBack" />
    <MudFab Size="Size.Small" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowCircleRight" OnClick="GoForward" />
</MudStack>

@code
{
    [Parameter] public int Index { get; set; } = 1;
    [Parameter] public string Type { get; set; } = "blog";
    [Parameter] public MarkdownResourceType ResourceType { get; set; } = MarkdownResourceType.Blog;

    private ILogger Logger => LoggerFactory.CreateLogger<TemplateIndexPage>();

    ContentTree Tree { get; set; } = new ContentTree();
    int LastIndex = 1;

    protected override async Task OnInitializedAsync()
    {
        // await Task.Delay(TimeSpan.FromSeconds(1));
        Tree = await MarkdownService.GetContentTree();
        var currentNode = Tree.Nodes
            .Where(w => w.Name.ToLower().Equals(Type))
            .FirstOrDefault();

        LastIndex = currentNode!.Children.Max(m => m.Index);

        StateHasChanged();
    }

    private void GoBack()
    {
        Index--;

        if (Index < 1)
        {
            Index = LastIndex;
        }

        NavigationManager.NavigateTo($"/{Type}/{Index}", false);
    }

    private void GoForward()
    {
        Index++;

        if (Index > LastIndex) Index = 1;
        NavigationManager.NavigateTo($"/{Type}/{Index}", false);
    }
}